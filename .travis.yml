language: python
python:
  - "3.7"
install:
  - sudo apt-get update
  - sudo apt-get install libgconf2-4 libxss1 unzip -y
  - sudo apt-get -f install -y
  - pip install -r requirement.txt
env:
  global:
  - USER="LyuLumos"
  - EMAIL="3208413453@qq.com"
  - REPO="VJudge-Spider-on-TravisCI"
  - FILES="out.csv"
  - GH_REPO="github.com/${USER}/${REPO}.git"
  # - secure: "put travis gem output here => http://docs.travis-ci.com/user/encryption-keys/"
before_script:
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i --force-depends google-chrome-stable_current_amd64.deb
  - LATEST=$(wget -q -O - http://chromedriver.storage.googleapis.com/LATEST_RELEASE)
  - wget http://chromedriver.storage.googleapis.com/$LATEST/chromedriver_linux64.zip
  - unzip chromedriver_linux64.zip
  - chmod +x chromedriver
  - sudo mv chromedriver /usr/bin/
  - chromedriver --version
script:
  - python run.py
  - 'if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then bash ./travis/run_on_pull_requests; fi'
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./travis/run_on_non_pull_requests; fi'
# after_success:
#   - MESSAGE=$(git log --format=%B -n 1 $TRAVIS_COMMIT)
#   - git clone https://${GH_REPO}
#   - mv -f ${FILES} ${REPO}
#   - cd ${REPO}
#   - git remote
#   - git config user.email ${EMAIL}
#   - git config user.name ${USER}
#   - git add ${FILES}
#   - git commit -m "${MESSAGE}"
#   - git push origin main
branches:
  only:
    - main